!function(e){e.fn.tipuesearch=function(t){var i=e.extend({show:7,newWindow:!1,showURL:!0,showTitleCount:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json",debug:!1},t);return this.each(function(){function t(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function s(t,c){e("#tipue_search_content").hide(),e("#tipue_search_content").html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>'),e("#tipue_search_content").show();var n="",o=!1,p=!1,l=!0,u=0;found=[];var g=e("#tipue_search_input").val().toLowerCase();if(g=e.trim(g),(g.match('^"')&&g.match('"$')||g.match("^'")&&g.match("'$"))&&(l=!1),l){var _=g.split(" ");g="";for(var d=0;d<_.length;d++){for(var v=!0,f=0;f<tipuesearch_stop_words.length;f++)_[d]==tipuesearch_stop_words[f]&&(v=!1,p=!0);v&&(g=g+" "+_[d])}g=e.trim(g),_=g.split(" ")}else g=g.substring(1,g.length-1);if(g.length>=i.minimumLength){if(l){if(c){for(var w=g,d=0;d<_.length;d++)for(var f=0;f<tipuesearch_replace.words.length;f++)_[d]==tipuesearch_replace.words[f].word&&(g=g.replace(_[d],tipuesearch_replace.words[f].replace_with),o=!0);_=g.split(" ")}for(var m=g,d=0;d<_.length;d++)for(var f=0;f<tipuesearch_stem.words.length;f++)_[d]==tipuesearch_stem.words[f].word&&(m=m+" "+tipuesearch_stem.words[f].stem);_=m.split(" ");for(var d=0;d<r.pages.length;d++){for(var x=0,b=r.pages[d].text,f=0;f<_.length;f++){var L=new RegExp(_[f],"gi");if(-1!=r.pages[d].title.search(L)){var E=r.pages[d].title.match(L).length;x+=20*E}if(-1!=r.pages[d].text.search(L)){var E=r.pages[d].text.match(L).length;x+=20*E}if(i.highlightTerms){if(i.highlightEveryTerm)var R=new RegExp("("+_[f]+")","gi");else var R=new RegExp("("+_[f]+")","i");b=b.replace(R,'<span class="h01">$1</span>')}if(-1!=r.pages[d].tags.search(L)){var E=r.pages[d].tags.match(L).length;x+=10*E}if(-1!=r.pages[d].url.search(L)&&(x+=20),0!=x)for(var C=0;C<tipuesearch_weight.weight.length;C++)r.pages[d].url==tipuesearch_weight.weight[C].url&&(x+=tipuesearch_weight.weight[C].score);_[f].match("^-")&&(L=new RegExp(_[f].substring(1),"i"),(-1!=r.pages[d].title.search(L)||-1!=r.pages[d].text.search(L)||-1!=r.pages[d].tags.search(L))&&(x=0))}0!=x&&(found.push({score:x,title:r.pages[d].title,desc:b,url:r.pages[d].url}),u++)}}else for(var d=0;d<r.pages.length;d++){var x=0,b=r.pages[d].text,L=new RegExp(g,"gi");if(-1!=r.pages[d].title.search(L)){var E=r.pages[d].title.match(L).length;x+=20*E}if(-1!=r.pages[d].text.search(L)){var E=r.pages[d].text.match(L).length;x+=20*E}if(i.highlightTerms){if(i.highlightEveryTerm)var R=new RegExp("("+g+")","gi");else var R=new RegExp("("+g+")","i");b=b.replace(R,'<span class="h01">$1</span>')}if(-1!=r.pages[d].tags.search(L)){var E=r.pages[d].tags.match(L).length;x+=10*E}if(-1!=r.pages[d].url.search(L)&&(x+=20),0!=x)for(var C=0;C<tipuesearch_weight.weight.length;C++)r.pages[d].url==tipuesearch_weight.weight[C].url&&(x+=tipuesearch_weight.weight[C].score);0!=x&&(found.push({score:x,title:r.pages[d].title,desc:b,url:r.pages[d].url}),u++)}if(0!=u){if(i.showTitleCount&&0==a){var T=document.title;document.title="("+u+") "+T,a++}1==o&&(n+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+g+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+w+"</a></div>"),1==u?n+='<div id="tipue_search_results_count">'+tipuesearch_string_4+"</div>":(c_c=u.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),n+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5+"</div>"),found.sort(function(e,t){return t.score-e.score});for(var y=0,d=0;d<found.length;d++){if(y>=t&&y<i.show+t){if(n+='<div class="tipue_search_content_title"><a href="'+found[d].url+'"'+h+">"+found[d].title+"</a></div>",i.debug&&(n+='<div class="tipue_search_content_debug">Score: '+found[d].score+"</div>"),i.showURL){var k=found[d].url.toLowerCase();0==k.indexOf("http://")&&(k=k.slice(7)),n+='<div class="tipue_search_content_url"><a href="'+found[d].url+'"'+h+">"+k+"</a></div>"}if(found[d].desc){var W=found[d].desc,$="",j=W.split(" ");if(j.length<i.descriptiveWords)$=W;else for(var f=0;f<i.descriptiveWords;f++)$+=j[f]+" ";$=e.trim($),"."!=$.charAt($.length-1)&&($+=" ..."),n+='<div class="tipue_search_content_text">'+$+"</div>"}}y++}if(u>i.show){var O=Math.ceil(u/i.show),S=t/i.show;if(n+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',t>0&&(n+='<li><a class="tipue_search_foot_box" id="'+(t-i.show)+"_"+c+'">'+tipuesearch_string_6+"</a></li>"),2>=S){var D=O;O>3&&(D=3);for(var f=0;D>f;f++)n+=f==S?'<li class="current">'+(f+1)+"</li>":'<li><a class="tipue_search_foot_box" id="'+f*i.show+"_"+c+'">'+(f+1)+"</a></li>"}else{var D=S+2;D>O&&(D=O);for(var f=S-1;D>f;f++)n+=f==S?'<li class="current">'+(f+1)+"</li>":'<li><a class="tipue_search_foot_box" id="'+f*i.show+"_"+c+'">'+(f+1)+"</a></li>"}S+1!=O&&(n+='<li><a class="tipue_search_foot_box" id="'+(t+i.show)+"_"+c+'">'+tipuesearch_string_7+"</a></li>"),n+="</ul></div>"}}else n+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else p?n+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(n+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",n+=1==i.minimumLength?'<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>":'<div id="tipue_search_warning">'+tipuesearch_string_12+" "+i.minimumLength+" "+tipuesearch_string_13+"</div>");e("#tipue_search_content").hide(),e("#tipue_search_content").html(n),e("#tipue_search_content").slideDown(200),e("#tipue_search_replaced").click(function(){s(0,!1)}),e(".tipue_search_foot_box").click(function(){var t=e(this).attr("id"),i=t.split("_");s(parseInt(i[0]),i[1])})}var r={pages:[]};e.ajaxSetup({async:!1});var a=0;if("live"==i.mode)for(var c=0;c<tipuesearch_pages.length;c++)e.get(tipuesearch_pages[c]).done(function(t){var s=e(i.liveContent,t).text();s=s.replace(/\s+/g," ");var a=e(i.liveDescription,t).text();a=a.replace(/\s+/g," ");var h=t.toLowerCase().indexOf("<title>"),n=t.toLowerCase().indexOf("</title>",h+7);if(-1!=h&&-1!=n)var o=t.slice(h+7,n);else var o=tipuesearch_string_1;r.pages.push({title:o,text:a,tags:s,url:tipuesearch_pages[c]})});"json"==i.mode&&e.getJSON(i.contentLocation).done(function(t){r=e.extend({},t)}),"static"==i.mode&&(r=e.extend({},tipuesearch));var h="";i.newWindow&&(h=' target="_blank"'),t("q")&&(e("#tipue_search_input").val(t("q")),s(0,!0)),e(this).keyup(function(e){"13"==e.keyCode&&s(0,!0)})})}}(jQuery);
